///////////////////////////////////////////////////////////
//  CUAbmPerfil.cs
//  Clase de implementación de CUAbmPerfil.
//  Generated by Fito
//  Created on:      08-abr-2009 11:32:54
//  Original author: Fito
///////////////////////////////////////////////////////////
using System.Windows.Forms;
using scioBaseLibrary;
using scioBaseLibrary.excepciones;
using scioControlLibrary;
using scioPersistentLibrary;
using scioSecureLibrary.dominio;
using scioSecureLibrary.dominio.repos;
using scioToolLibrary;
using scioToolLibrary.enums;

namespace cuConfigurarUsuarios {
    /// <summary>
    /// Esta clase hereda de CUAbmGenerico y se encarga de gestionar la 
    /// ventana WinABMV junto con su panelABMV para la entidad Perfil.
    /// </summary>
    public class CUAbmPerfil : CUAbmGenerico<Perfil> {
        #region IControladorEditable Members
        /// <summary>
        /// Implementación del método de la interfaz.
        /// </summary>
        public override PanelABMV<Perfil> crearPanelEdicion() {
            return new PanelAbmvPerfil(this);
        }

        /// <summary>
        /// Implementación del método de la interfaz.
        /// </summary>
        public override void remove(params object[] parametros) {
            if (ObjetoEnEdicion != null)
                if (Sistema.Controlador.mostrar("PREGUNTA-NOUNDO-ACTION", ENivelMensaje.PREGUNTA, null, false)
                    == DialogResult.Yes) {
                    Perfil perfil = ObjetoEnEdicion;

                    long scn = Persistencia.Controlador.iniciarTransaccion();
                    foreach (Usuario user in Usuarios.GetAliveByPerfil(perfil))
                        user.quitarPerfil(perfil);                 
                    perfil.delete();
                    Persistencia.Controlador.commitTransaccion(scn);
                }
        }

        /// <summary>
        /// Implementación del método de la interfaz.
        /// </summary>
        public override void verify(params object[] parametros) {
            if (string.IsNullOrEmpty(ObjetoEnEdicion.Nombre))
                throw new DataErrorException("CAMPO-NOK", Mensaje.TextoValidacion("PERFIL-NOMBRE"));
        }
        #endregion
    }
}